/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const e=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),i=new Map;class r{constructor(t,e){if(this._$cssResult$=!0,e!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=i.get(this.cssText);return e&&void 0===t&&(i.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const o=(t,...e)=>{const i=1===t.length?t[0]:e.reduce(((e,n,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[i+1]),t[0]);return new r(i,n)},s=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new r("string"==typeof t?t:t+"",n))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var a;const c=window.trustedTypes,u=c?c.emptyScript:"",h=window.reactiveElementPolyfillSupport,l={toAttribute(t,e){switch(e){case Boolean:t=t?u:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},d=(t,e)=>e!==t&&(e==e||t==t),f={attribute:!0,type:String,converter:l,reflect:!1,hasChanged:d};class p extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var e;null!==(e=this.l)&&void 0!==e||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const i=this._$Eh(n,e);void 0!==i&&(this._$Eu.set(i,n),t.push(i))})),t}static createProperty(t,e=f){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,i=this.getPropertyDescriptor(t,n,e);void 0!==i&&Object.defineProperty(this.prototype,t,i)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(i){const r=this[t];this[e]=i,this.requestUpdate(t,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||f}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(s(t))}else void 0!==t&&e.push(s(t));return e}static _$Eh(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}o(){var t;this._$Ep=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(t=this.constructor.l)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$Eg)&&void 0!==e?e:this._$Eg=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$Eg)||void 0===e||e.splice(this._$Eg.indexOf(t)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Et.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const n=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,n)=>{e?t.adoptedStyleSheets=n.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):n.forEach((e=>{const n=document.createElement("style"),i=window.litNonce;void 0!==i&&n.setAttribute("nonce",i),n.textContent=e.cssText,t.appendChild(n)}))})(n,this.constructor.elementStyles),n}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$ES(t,e,n=f){var i,r;const o=this.constructor._$Eh(t,n);if(void 0!==o&&!0===n.reflect){const s=(null!==(r=null===(i=n.converter)||void 0===i?void 0:i.toAttribute)&&void 0!==r?r:l.toAttribute)(e,n.type);this._$Ei=t,null==s?this.removeAttribute(o):this.setAttribute(o,s),this._$Ei=null}}_$AK(t,e){var n,i,r;const o=this.constructor,s=o._$Eu.get(t);if(void 0!==s&&this._$Ei!==s){const t=o.getPropertyOptions(s),a=t.converter,c=null!==(r=null!==(i=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==i?i:"function"==typeof a?a:null)&&void 0!==r?r:l.fromAttribute;this._$Ei=s,this[s]=c(e,t.type),this._$Ei=null}}requestUpdate(t,e,n){let i=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||d)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Ei!==t&&(void 0===this._$E_&&(this._$E_=new Map),this._$E_.set(t,n))):i=!1),!this.isUpdatePending&&i&&(this._$Ep=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ep}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((t,e)=>this[e]=t)),this._$Et=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$Eg)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(t){return!0}update(t){void 0!==this._$E_&&(this._$E_.forEach(((t,e)=>this._$ES(e,this[e],t))),this._$E_=void 0),this._$EU()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var v;p.finalized=!0,p.elementProperties=new Map,p.elementStyles=[],p.shadowRootOptions={mode:"open"},null==h||h({ReactiveElement:p}),(null!==(a=globalThis.reactiveElementVersions)&&void 0!==a?a:globalThis.reactiveElementVersions=[]).push("1.2.0");const y=globalThis.trustedTypes,g=y?y.createPolicy("lit-html",{createHTML:t=>t}):void 0,m=`lit$${(Math.random()+"").slice(9)}$`,_="?"+m,w=`<${_}>`,S=document,x=(t="")=>S.createComment(t),b=t=>null===t||"object"!=typeof t&&"function"!=typeof t,E=Array.isArray,$=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,A=/-->/g,C=/>/g,N=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,T=/'/g,O=/"/g,P=/^(?:script|style|textarea)$/i,k=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),R=Symbol.for("lit-noChange"),U=Symbol.for("lit-nothing"),M=new WeakMap,j=S.createTreeWalker(S,129,null,!1),D=(t,e)=>{const n=t.length-1,i=[];let r,o=2===e?"<svg>":"",s=$;for(let e=0;e<n;e++){const n=t[e];let a,c,u=-1,h=0;for(;h<n.length&&(s.lastIndex=h,c=s.exec(n),null!==c);)h=s.lastIndex,s===$?"!--"===c[1]?s=A:void 0!==c[1]?s=C:void 0!==c[2]?(P.test(c[2])&&(r=RegExp("</"+c[2],"g")),s=N):void 0!==c[3]&&(s=N):s===N?">"===c[0]?(s=null!=r?r:$,u=-1):void 0===c[1]?u=-2:(u=s.lastIndex-c[2].length,a=c[1],s=void 0===c[3]?N:'"'===c[3]?O:T):s===O||s===T?s=N:s===A||s===C?s=$:(s=N,r=void 0);const l=s===N&&t[e+1].startsWith("/>")?" ":"";o+=s===$?n+w:u>=0?(i.push(a),n.slice(0,u)+"$lit$"+n.slice(u)+m+l):n+m+(-2===u?(i.push(void 0),e):l)}const a=o+(t[n]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==g?g.createHTML(a):a,i]};class L{constructor({strings:t,_$litType$:e},n){let i;this.parts=[];let r=0,o=0;const s=t.length-1,a=this.parts,[c,u]=D(t,e);if(this.el=L.createElement(c,n),j.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(i=j.nextNode())&&a.length<s;){if(1===i.nodeType){if(i.hasAttributes()){const t=[];for(const e of i.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(m)){const n=u[o++];if(t.push(e),void 0!==n){const t=i.getAttribute(n.toLowerCase()+"$lit$").split(m),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:r,name:e[2],strings:t,ctor:"."===e[1]?B:"?"===e[1]?J:"@"===e[1]?q:H})}else a.push({type:6,index:r})}for(const e of t)i.removeAttribute(e)}if(P.test(i.tagName)){const t=i.textContent.split(m),e=t.length-1;if(e>0){i.textContent=y?y.emptyScript:"";for(let n=0;n<e;n++)i.append(t[n],x()),j.nextNode(),a.push({type:2,index:++r});i.append(t[e],x())}}}else if(8===i.nodeType)if(i.data===_)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(m,t+1));)a.push({type:7,index:r}),t+=m.length-1}r++}}static createElement(t,e){const n=S.createElement("template");return n.innerHTML=t,n}}function I(t,e,n=t,i){var r,o,s,a;if(e===R)return e;let c=void 0!==i?null===(r=n._$Cl)||void 0===r?void 0:r[i]:n._$Cu;const u=b(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==u&&(null===(o=null==c?void 0:c._$AO)||void 0===o||o.call(c,!1),void 0===u?c=void 0:(c=new u(t),c._$AT(t,n,i)),void 0!==i?(null!==(s=(a=n)._$Cl)&&void 0!==s?s:a._$Cl=[])[i]=c:n._$Cu=c),void 0!==c&&(e=I(t,c._$AS(t,e.values),c,i)),e}class z{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:n},parts:i}=this._$AD,r=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:S).importNode(n,!0);j.currentNode=r;let o=j.nextNode(),s=0,a=0,c=i[0];for(;void 0!==c;){if(s===c.index){let e;2===c.type?e=new V(o,o.nextSibling,this,t):1===c.type?e=new c.ctor(o,c.name,c.strings,this,t):6===c.type&&(e=new G(o,this,t)),this.v.push(e),c=i[++a]}s!==(null==c?void 0:c.index)&&(o=j.nextNode(),s++)}return r}m(t){let e=0;for(const n of this.v)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class V{constructor(t,e,n,i){var r;this.type=2,this._$AH=U,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=i,this._$Cg=null===(r=null==i?void 0:i.isConnected)||void 0===r||r}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=I(this,t,e),b(t)?t===U||null==t||""===t?(this._$AH!==U&&this._$AR(),this._$AH=U):t!==this._$AH&&t!==R&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.S(t):(t=>{var e;return E(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.A(t):this.$(t)}M(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}S(t){this._$AH!==t&&(this._$AR(),this._$AH=this.M(t))}$(t){this._$AH!==U&&b(this._$AH)?this._$AA.nextSibling.data=t:this.S(S.createTextNode(t)),this._$AH=t}T(t){var e;const{values:n,_$litType$:i}=t,r="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=L.createElement(i.h,this.options)),i);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===r)this._$AH.m(n);else{const t=new z(r,this),e=t.p(this.options);t.m(n),this.S(e),this._$AH=t}}_$AC(t){let e=M.get(t.strings);return void 0===e&&M.set(t.strings,e=new L(t)),e}A(t){E(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,i=0;for(const r of t)i===e.length?e.push(n=new V(this.M(x()),this.M(x()),this,this.options)):n=e[i],n._$AI(r),i++;i<e.length&&(this._$AR(n&&n._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cg=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class H{constructor(t,e,n,i,r){this.type=1,this._$AH=U,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=U}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,i){const r=this.strings;let o=!1;if(void 0===r)t=I(this,t,e,0),o=!b(t)||t!==this._$AH&&t!==R,o&&(this._$AH=t);else{const i=t;let s,a;for(t=r[0],s=0;s<r.length-1;s++)a=I(this,i[n+s],e,s),a===R&&(a=this._$AH[s]),o||(o=!b(a)||a!==this._$AH[s]),a===U?t=U:t!==U&&(t+=(null!=a?a:"")+r[s+1]),this._$AH[s]=a}o&&!i&&this.k(t)}k(t){t===U?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class B extends H{constructor(){super(...arguments),this.type=3}k(t){this.element[this.name]=t===U?void 0:t}}const F=y?y.emptyScript:"";class J extends H{constructor(){super(...arguments),this.type=4}k(t){t&&t!==U?this.element.setAttribute(this.name,F):this.element.removeAttribute(this.name)}}class q extends H{constructor(t,e,n,i,r){super(t,e,n,i,r),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=I(this,t,e,0))&&void 0!==n?n:U)===R)return;const i=this._$AH,r=t===U&&i!==U||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==U&&(i===U||r);r&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class G{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){I(this,t)}}const W=window.litHtmlPolyfillSupport;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var X,K;null==W||W(L,V),(null!==(v=globalThis.litHtmlVersions)&&void 0!==v?v:globalThis.litHtmlVersions=[]).push("2.1.1");class Z extends p{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Dt=((t,e,n)=>{var i,r;const o=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:e;let s=o._$litPart$;if(void 0===s){const t=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:null;o._$litPart$=s=new V(e.insertBefore(x(),t),t,void 0,null!=n?n:{})}return s._$AI(t),s})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!1)}render(){return R}}Z.finalized=!0,Z._$litElement$=!0,null===(X=globalThis.litElementHydrateSupport)||void 0===X||X.call(globalThis,{LitElement:Z});const Q=globalThis.litElementPolyfillSupport;null==Q||Q({LitElement:Z}),(null!==(K=globalThis.litElementVersions)&&void 0!==K?K:globalThis.litElementVersions=[]).push("3.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Y=t=>e=>"function"==typeof e?((t,e)=>(window.customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:n,elements:i}=e;return{kind:n,elements:i,finisher(e){window.customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,tt=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(n){n.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(n){n.createProperty(e.key,t)}};function et(t){return(e,n)=>void 0!==n?((t,e,n)=>{e.constructor.createProperty(n,t)})(t,e,n):tt(t,e)}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var nt;null===(nt=window.HTMLSlotElement)||void 0===nt||nt.prototype.assignedElements;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var it=function(){return it=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},it.apply(this,arguments)};function rt(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}function ot(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function st(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function at(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}var ct={};function ut(t){return Object.keys(t)}function ht(t,e,n){void 0===n&&(n=".");var i=ft(t,n),r=ft(e,n);return Ot(r)?!!Ot(i)&&r===i:Ot(i)?i in r:ut(i).every((function(t){return t in r&&ht(i[t],r[t])}))}function lt(t){try{return Ot(t)||"number"==typeof t?"".concat(t):t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function dt(t,e){try{return Nt(t)?t:t.toString().split(e)}catch(e){throw new Error("'".concat(t,"' is not a valid state path."))}}function ft(t,e){return"object"==typeof(n=t)&&"value"in n&&"context"in n&&"event"in n&&"_event"in n?t.value:Nt(t)?pt(t):"string"!=typeof t?t:pt(dt(t,e));var n}function pt(t){if(1===t.length)return t[0];for(var e={},n=e,i=0;i<t.length-1;i++)i===t.length-2?n[t[i]]=t[i+1]:(n[t[i]]={},n=n[t[i]]);return e}function vt(t,e){for(var n={},i=ut(t),r=0;r<i.length;r++){var o=i[r];n[o]=e(t[o],o,t,r)}return n}function yt(t,e,n){var i,r,o={};try{for(var s=ot(ut(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];n(u)&&(o[c]=e(u,c,t))}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}var gt=function(t){return function(e){var n,i,r=e;try{for(var o=ot(t),s=o.next();!s.done;s=o.next()){r=r[s.value]}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r}};function mt(t){return t?Ot(t)?[[t]]:_t(ut(t).map((function(e){var n=t[e];return"string"==typeof n||n&&Object.keys(n).length?mt(t[e]).map((function(t){return[e].concat(t)})):[[e]]}))):[[]]}function _t(t){var e;return(e=[]).concat.apply(e,at([],st(t),!1))}function wt(t){return Nt(t)?t:[t]}function St(t){return void 0===t?[]:wt(t)}function xt(t,e,n){var i,r;if(Tt(t))return t(e,n.data);var o={};try{for(var s=ot(Object.keys(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];Tt(u)?o[c]=u(e,n.data):o[c]=u}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function bt(t){return t instanceof Promise||!(null===t||!Tt(t)&&"object"!=typeof t||!Tt(t.then))}function Et(t,e){var n,i,r=st([[],[]],2),o=r[0],s=r[1];try{for(var a=ot(t),c=a.next();!c.done;c=a.next()){var u=c.value;e(u)?o.push(u):s.push(u)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return[o,s]}function $t(t,e){return vt(t.states,(function(t,n){if(t){var i=(Ot(e)?void 0:e[n])||(t?t.current:void 0);if(i)return{current:i,states:$t(t,i)}}}))}function At(t,e,n,i){return Ct(!!t,"Attempting to update undefined context"),t?n.reduce((function(t,n){var r,o,s=n.assignment,a={state:i,action:n,_event:e},c={};if(Tt(s))c=s(t,e.data,a);else try{for(var u=ot(ut(s)),h=u.next();!h.done;h=u.next()){var l=h.value,d=s[l];c[l]=Tt(d)?d(t,e.data,a):d}}catch(t){r={error:t}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return Object.assign({},t,c)}),t):t}var Ct=function(){};function Nt(t){return Array.isArray(t)}function Tt(t){return"function"==typeof t}function Ot(t){return"string"==typeof t}function Pt(t,e){if(t)return Ot(t)?{type:"xstate.guard",name:t,predicate:e?e[t]:void 0}:Tt(t)?{type:"xstate.guard",name:t.name,predicate:t}:t}Ct=function(t,e){var n=t instanceof Error?t:void 0;if((n||!t)&&void 0!==console){var i=["Warning: ".concat(e)];n&&i.push(n),console.warn.apply(console,i)}};var kt,Rt,Ut=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Mt(t){try{return"__xstatenode"in t}catch(t){return!1}}function jt(t,e){return Ot(t)||"number"==typeof t?it({type:t},e):t}function Dt(t,e){if(!Ot(t)&&"$$type"in t&&"scxml"===t.$$type)return t;var n=jt(t);return it({name:n.type,data:n,$$type:"scxml",type:"external"},e)}function Lt(t,e){return wt(e).map((function(e){return void 0===e||"string"==typeof e||Mt(e)?{target:e,event:t}:it(it({},e),{event:t})}))}function It(t,e,n,i,r){var o=t.options.guards,s={state:r,cond:e,_event:i};if("xstate.guard"===e.type)return((null==o?void 0:o[e.name])||e.predicate)(n,i.data,s);var a=o[e.type];if(!a)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return a(n,i.data,s)}function zt(t){return"string"==typeof t?{type:t}:t}function Vt(t,e,n){if("object"==typeof t)return t;var i=function(){};return{next:t,error:e||i,complete:n||i}}!function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"}(kt||(kt={})),function(t){t.Parent="#_parent",t.Internal="#_internal"}(Rt||(Rt={}));var Ht=kt.Start,Bt=kt.Stop,Ft=kt.Raise,Jt=kt.Send,qt=kt.Cancel,Gt=kt.NullEvent,Wt=kt.Assign;kt.After,kt.DoneState;var Xt=kt.Log,Kt=kt.Init,Zt=kt.Invoke;kt.ErrorExecution;var Qt=kt.ErrorPlatform,Yt=kt.ErrorCustom,te=kt.Update,ee=kt.Choose,ne=kt.Pure,ie=Dt({type:Kt});function re(t,e){return e&&e[t]||void 0}function oe(t,e){var n;if(Ot(t)||"number"==typeof t)n=Tt(i=re(t,e))?{type:t,exec:i}:i||{type:t,exec:void 0};else if(Tt(t))n={type:t.name||t.toString(),exec:t};else{var i;if(Tt(i=re(t.type,e)))n=it(it({},t),{exec:i});else if(i){var r=i.type||t.type;n=it(it(it({},i),t),{type:r})}else n=t}return n}var se=function(t,e){return t?(Nt(t)?t:[t]).map((function(t){return oe(t,e)})):[]};function ae(t){var e=oe(t);return it(it({id:Ot(t)?t:e.id},e),{type:e.type})}function ce(t){return Ot(t)?{type:Ft,event:t}:ue(t,{to:Rt.Internal})}function ue(t,e){return{to:e?e.to:void 0,type:Jt,event:Tt(t)?t:jt(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:Tt(t)?t.name:lt(t)}}var he=function(t){return{type:Wt,assignment:t}};function le(t,e){var n="".concat(kt.DoneState,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function de(t,e){var n="".concat(kt.DoneInvoke,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function fe(t,e){var n="".concat(kt.ErrorPlatform,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function pe(t,e,n,i,r,o){void 0===o&&(o=!1);var s=st(o?[[],r]:Et(r,(function(t){return t.type===Wt})),2),a=s[0],c=s[1],u=a.length?At(n,i,a,e):n,h=o?[n]:void 0,l=_t(c.map((function(n){var r;switch(n.type){case Ft:return{type:Ft,_event:Dt(n.event)};case Jt:var s=function(t,e,n,i){var r,o={_event:n},s=Dt(Tt(t.event)?t.event(e,n.data,o):t.event);if(Ot(t.delay)){var a=i&&i[t.delay];r=Tt(a)?a(e,n.data,o):a}else r=Tt(t.delay)?t.delay(e,n.data,o):t.delay;var c=Tt(t.to)?t.to(e,n.data,o):t.to;return it(it({},t),{to:c,_event:s,event:s.data,delay:r})}(n,u,i,t.options.delays);return Ct(!Ot(n.delay)||"number"==typeof s.delay,"No delay reference for delay expression '".concat(n.delay,"' was found on machine '").concat(t.id,"'")),s;case Xt:return function(t,e,n){return it(it({},t),{value:Ot(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})}(n,u,i);case ee:if(!(d=null===(r=n.conds.find((function(n){var r=Pt(n.cond,t.options.guards);return!r||It(t,r,u,i,e)})))||void 0===r?void 0:r.actions))return[];var a=st(pe(t,e,u,i,se(St(d),t.options.actions),o),2),c=a[0],l=a[1];return u=l,null==h||h.push(u),c;case ne:var d;if(!(d=n.get(u,i.data)))return[];var f=st(pe(t,e,u,i,se(St(d),t.options.actions),o),2),p=f[0],v=f[1];return u=v,null==h||h.push(u),p;case Bt:return function(t,e,n){var i=Tt(t.activity)?t.activity(e,n.data):t.activity,r="string"==typeof i?{id:i}:i;return{type:kt.Stop,activity:r}}(n,u,i);case Wt:u=At(u,i,[n],e),null==h||h.push(u);break;default:var y=oe(n,t.options.actions),g=y.exec;if(g&&h){var m=h.length-1;y=it(it({},y),{exec:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.apply(void 0,at([h[m]],st(e),!1))}})}return y}})).filter((function(t){return!!t})));return[l,u]}var ve=function(t){return"atomic"===t.type||"final"===t.type};function ye(t){return ut(t.states).map((function(e){return t.states[e]}))}function ge(t){var e=[t];return ve(t)?e:e.concat(_t(ye(t).map(ge)))}function me(t,e){var n,i,r,o,s,a,c,u,h=we(new Set(t)),l=new Set(e);try{for(var d=ot(l),f=d.next();!f.done;f=d.next())for(var p=(b=f.value).parent;p&&!l.has(p);)l.add(p),p=p.parent}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}var v=we(l);try{for(var y=ot(l),g=y.next();!g.done;g=y.next()){if("compound"!==(b=g.value).type||v.get(b)&&v.get(b).length){if("parallel"===b.type)try{for(var m=(s=void 0,ot(ye(b))),_=m.next();!_.done;_=m.next()){var w=_.value;"history"!==w.type&&(l.has(w)||(l.add(w),h.get(w)?h.get(w).forEach((function(t){return l.add(t)})):w.initialStateNodes.forEach((function(t){return l.add(t)}))))}}catch(t){s={error:t}}finally{try{_&&!_.done&&(a=m.return)&&a.call(m)}finally{if(s)throw s.error}}}else h.get(b)?h.get(b).forEach((function(t){return l.add(t)})):b.initialStateNodes.forEach((function(t){return l.add(t)}))}}catch(t){r={error:t}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}try{for(var S=ot(l),x=S.next();!x.done;x=S.next()){var b;for(p=(b=x.value).parent;p&&!l.has(p);)l.add(p),p=p.parent}}catch(t){c={error:t}}finally{try{x&&!x.done&&(u=S.return)&&u.call(S)}finally{if(c)throw c.error}}return l}function _e(t,e){var n=e.get(t);if(!n)return{};if("compound"===t.type){var i=n[0];if(!i)return{};if(ve(i))return i.key}var r={};return n.forEach((function(t){r[t.key]=_e(t,e)})),r}function we(t){var e,n,i=new Map;try{for(var r=ot(t),o=r.next();!o.done;o=r.next()){var s=o.value;i.has(s)||i.set(s,[]),s.parent&&(i.has(s.parent)||i.set(s.parent,[]),i.get(s.parent).push(s))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i}function Se(t,e){return _e(t,we(me([t],e)))}function xe(t,e){return Array.isArray(t)?t.some((function(t){return t===e})):t instanceof Set&&t.has(e)}function be(t,e){return"compound"===e.type?ye(e).some((function(e){return"final"===e.type&&xe(t,e)})):"parallel"===e.type&&ye(e).every((function(e){return be(t,e)}))}function Ee(t){return new Set(_t(t.map((function(t){return t.tags}))))}function $e(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;if(Ot(t)||Ot(e))return t===e;var n=ut(t),i=ut(e);return n.length===i.length&&n.every((function(n){return $e(t[n],e[n])}))}var Ae=function(){function t(t){var e,n,i=this;this.actions=[],this.activities=ct,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||ct,this.meta=(void 0===(n=t.configuration)&&(n=[]),n.reduce((function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t}),{})),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=null!==(e=Array.isArray(t.tags)?new Set(t.tags):t.tags)&&void 0!==e?e:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return function(t){return at([],st(new Set(_t(at([],st(t.map((function(t){return t.ownEvents}))),!1)))),!1)}(i.configuration)}})}return t.from=function(e,n){return e instanceof t?e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e:new t({value:e,context:n,_event:ie,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var i=ie;return new t({value:e.value,context:n,_event:i,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),Ot(t))return[t];var i=ut(t);return i.concat.apply(i,at([],st(i.map((function(i){return n.toStrings(t[i],e).map((function(t){return i+e+t}))}))),!1))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var n=rt(t,["configuration","transitions","tags","machine"]);return it(it({},n),{tags:Array.from(e)})},t.prototype.matches=function(t){return ht(t,this.value)},t.prototype.hasTag=function(t){return this.tags.has(t)},t.prototype.can=function(t){var e,n=null===(e=this.machine)||void 0===e?void 0:e.getTransitionData(this,t);return!!(null==n?void 0:n.transitions.length)&&n.transitions.some((function(t){return void 0!==t.target||t.actions.length}))},t}(),Ce=function(t,e){return e(t)};function Ne(t){return{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}}}function Te(t,e,n,i){var r,o=zt(t.src),s=null===(r=null==e?void 0:e.options.services)||void 0===r?void 0:r[o.type],a=t.data?xt(t.data,n,i):void 0,c=s?function(t,e,n){var i=Ne(e);if(i.deferred=!0,Mt(t)){var r=i.state=Ce(void 0,(function(){return(n?t.withContext(n):t).initialState}));i.getSnapshot=function(){return r}}return i}(s,t.id,a):Ne(t.id);return c.meta=t,c}function Oe(t){if("string"==typeof t){var e={type:t,toString:function(){return t}};return e}return t}function Pe(t){return it(it({type:Zt},t),{toJSON:function(){t.onDone,t.onError;var e=rt(t,["onDone","onError"]);return it(it({},e),{type:Zt,src:Oe(t.src)})}})}var ke={},Re=function(t){return"#"===t[0]},Ue=function(){function t(e,n,i){var r,o=this;void 0===i&&(i="context"in e?e.context:void 0),this.config=e,this._context=i,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},n),this.parent=this.options._parent,this.key=this.config.key||this.options._key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:"."),this.id=this.config.id||at([this.machine.key],st(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&ut(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(r=this.config.schema)&&void 0!==r?r:{},this.description=this.config.description,Ct(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?vt(this.config.states,(function(e,n){var i,r=new t(e,{_parent:o,_key:n});return Object.assign(o.idMap,it(((i={})[r.id]=r,i),r.idMap)),r})):ke;var s=0;!function t(e){var n,i;e.order=s++;try{for(var r=ot(ye(e)),o=r.next();!o.done;o=r.next()){t(o.value)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some((function(t){return""===t.event})):""in this.config.on),this.strict=!!this.config.strict,this.onEntry=St(this.config.entry||this.config.onEntry).map((function(t){return oe(t)})),this.onExit=St(this.config.exit||this.config.onExit).map((function(t){return oe(t)})),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=St(this.config.invoke).map((function(t,e){var n,i;if(Mt(t))return o.machine.options.services=it(((n={})[t.id]=t,n),o.machine.options.services),Pe({src:t.id,id:t.id});if(Ot(t.src))return Pe(it(it({},t),{id:t.id||t.src,src:t.src}));if(Mt(t.src)||Tt(t.src)){var r="".concat(o.id,":invocation[").concat(e,"]");return o.machine.options.services=it(((i={})[r]=t.src,i),o.machine.options.services),Pe(it(it({id:r},t),{src:r}))}var s=t.src;return Pe(it(it({id:s.type},t),{src:s}))})),this.activities=St(this.config.activities).concat(this.invoke).map((function(t){return ae(t)})),this.transition=this.transition.bind(this),this.tags=St(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||ge(this).forEach((function(t){return t.on}))},t.prototype.withConfig=function(e,n){var i=this.options,r=i.actions,o=i.activities,s=i.guards,a=i.services,c=i.delays;return new t(this.config,{actions:it(it({},r),e.actions),activities:it(it({},o),e.activities),guards:it(it({},s),e.guards),services:it(it({},a),e.services),delays:it(it({},c),e.delays)},null!=n?n:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return Tt(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:vt(this.states,(function(t){return t.definition})),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce((function(t,e){return t[e.eventType]=t[e.eventType]||[],t[e.eventType].push(e),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=""===t,n=this.transitions.filter((function(n){var i=n.eventType===t;return e?i:i||"*"===n.eventType}));return this.__cache.candidates[t]=n,n},t.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var n=function(e,n){var i=function(t,e){var n=e?"#".concat(e):"";return"".concat(kt.After,"(").concat(t,")").concat(n)}(Tt(e)?"".concat(t.id,":delay[").concat(n,"]"):e,t.id);return t.onEntry.push(ue(i,{delay:e})),t.onExit.push({type:qt,sendId:i}),i},i=Nt(e)?e.map((function(t,e){var i=n(t.delay,e);return it(it({},t),{event:i})})):_t(ut(e).map((function(t,i){var r=e[t],o=Ot(r)?{target:r}:r,s=isNaN(+t)?t:+t,a=n(s,i);return St(o).map((function(t){return it(it({},t),{event:a,delay:s})}))})));return i.map((function(e){var n=e.delay;return it(it({},t.formatTransition(e)),{delay:n})}))},t.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var i=t instanceof Ae?t.value:ft(t,this.delimiter);if(Ot(i)){var r=this.getStateNode(i).initial;return void 0!==r?this.getStateNodes(((e={})[i]=r,e)):[this,this.states[i]]}var o=ut(i),s=[this];return s.push.apply(s,at([],st(_t(o.map((function(t){return n.getStateNode(t).getStateNodes(i[t])})))),!1)),s},t.prototype.handles=function(t){var e=lt(t);return this.events.includes(e)},t.prototype.resolveState=function(t){var e=Array.from(me([],this.getStateNodes(t.value)));return new Ae(it(it({},t),{value:this.resolve(t.value),configuration:e,done:be(e,this),tags:Ee(e)}))},t.prototype.transitionLeafNode=function(t,e,n){var i=this.getStateNode(t).next(e,n);return i&&i.transitions.length?i:this.next(e,n)},t.prototype.transitionCompoundNode=function(t,e,n){var i=ut(t),r=this.getStateNode(i[0])._transition(t[i[0]],e,n);return r&&r.transitions.length?r:this.next(e,n)},t.prototype.transitionParallelNode=function(t,e,n){var i,r,o={};try{for(var s=ot(ut(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];if(u){var h=this.getStateNode(c)._transition(u,e,n);h&&(o[c]=h)}}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}var l=ut(o).map((function(t){return o[t]})),d=_t(l.map((function(t){return t.transitions})));if(!l.some((function(t){return t.transitions.length>0})))return this.next(e,n);var f=_t(l.map((function(t){return t.entrySet}))),p=_t(ut(o).map((function(t){return o[t].configuration})));return{transitions:d,entrySet:f,exitSet:_t(l.map((function(t){return t.exitSet}))),configuration:p,source:e,actions:_t(ut(o).map((function(t){return o[t].actions})))}},t.prototype._transition=function(t,e,n){return Ot(t)?this.transitionLeafNode(t,e,n):1===ut(t).length?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},t.prototype.getTransitionData=function(t,e){return this._transition(t.value,t,Dt(e))},t.prototype.next=function(t,e){var n,i,r,o=this,s=e.name,a=[],c=[];try{for(var u=ot(this.getCandidates(s)),h=u.next();!h.done;h=u.next()){var l=h.value,d=l.cond,f=l.in,p=t.context,v=!f||(Ot(f)&&Re(f)?t.matches(ft(this.getStateNodeById(f).path,this.delimiter)):ht(ft(f,this.delimiter),gt(this.path.slice(0,-2))(t.value))),y=!1;try{y=!d||It(this.machine,d,p,e,t)}catch(t){throw new Error("Unable to evaluate guard '".concat(d.name||d.type,"' in transition for event '").concat(s,"' in state node '").concat(this.id,"':\n").concat(t.message))}if(y&&v){void 0!==l.target&&(c=l.target),a.push.apply(a,at([],st(l.actions),!1)),r=l;break}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(r){if(!c.length)return{transitions:[r],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:a};var g=_t(c.map((function(e){return o.getRelativeStateNodes(e,t.historyValue)}))),m=!!r.internal,_=m?[]:_t(g.map((function(t){return o.nodesFromChild(t)})));return{transitions:[r],entrySet:_,exitSet:m?[]:[this],configuration:g,source:t,actions:a}}},t.prototype.nodesFromChild=function(t){if(t.escapes(this))return[];for(var e=[],n=t;n&&n!==this;)e.push(n),n=n.parent;return e.push(this),e},t.prototype.escapes=function(t){if(this===t)return!1;for(var e=this.parent;e;){if(e===t)return!1;e=e.parent}return!0},t.prototype.getActions=function(t,e,n,i){var r,o,s,a,c=me([],i?this.getStateNodes(i.value):[this]),u=t.configuration.length?me(c,t.configuration):c;try{for(var h=ot(u),l=h.next();!l.done;l=h.next()){xe(c,p=l.value)||t.entrySet.push(p)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}try{for(var d=ot(c),f=d.next();!f.done;f=d.next()){var p;xe(u,p=f.value)&&!xe(t.exitSet,p.parent)||t.exitSet.push(p)}}catch(t){s={error:t}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(s)throw s.error}}var v=_t(t.entrySet.map((function(i){var r=[];if("final"!==i.type)return r;var o=i.parent;if(!o.parent)return r;r.push(le(i.id,i.doneData),le(o.id,i.doneData?xt(i.doneData,e,n):void 0));var s=o.parent;return"parallel"===s.type&&ye(s).every((function(e){return be(t.configuration,e)}))&&r.push(le(s.id)),r})));t.exitSet.sort((function(t,e){return e.order-t.order})),t.entrySet.sort((function(t,e){return t.order-e.order}));var y=new Set(t.entrySet),g=new Set(t.exitSet),m=st([_t(Array.from(y).map((function(t){return at(at([],st(t.activities.map((function(t){return function(t){var e=ae(t);return{type:kt.Start,activity:e,exec:void 0}}(t)}))),!1),st(t.onEntry),!1)}))).concat(v.map(ce)),_t(Array.from(g).map((function(t){return at(at([],st(t.onExit),!1),st(t.activities.map((function(t){return function(t){var e=Tt(t)?t:ae(t);return{type:kt.Stop,activity:e,exec:void 0}}(t)}))),!1)})))],2),_=m[0],w=m[1];return se(w.concat(t.actions).concat(_),this.machine.options.actions)},t.prototype.transition=function(t,e,n){void 0===t&&(t=this.initialState);var i,r,o=Dt(e);if(t instanceof Ae)i=void 0===n?t:this.resolveState(Ae.from(t,n));else{var s=Ot(t)?this.resolve(pt(this.getResolvedPath(t))):this.resolve(t),a=null!=n?n:this.machine.context;i=this.resolveState(Ae.from(s,a))}if("*"===o.name)throw new Error("An event cannot have the wildcard type ('".concat("*","')"));if(this.strict&&!this.events.includes(o.name)&&(r=o.name,!/^(done|error)\./.test(r)))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(o.name,"'"));var c=this._transition(i.value,i,o)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:i,actions:[]},u=me([],this.getStateNodes(i.value)),h=c.configuration.length?me(u,c.configuration):u;return c.configuration=at([],st(h),!1),this.resolveTransition(c,i,o)},t.prototype.resolveRaisedTransition=function(t,e,n){var i,r=t.actions;return(t=this.transition(t,e))._event=n,t.event=n.data,(i=t.actions).unshift.apply(i,at([],st(r),!1)),t},t.prototype.resolveTransition=function(t,e,n,i){var r,o,s=this;void 0===n&&(n=ie),void 0===i&&(i=this.machine.context);var a=t.configuration,c=!e||t.transitions.length>0,u=c?Se(this.machine,a):void 0,h=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,l=e?e.context:i,d=this.getActions(t,l,n,e),f=e?it({},e.activities):{};try{for(var p=ot(d),v=p.next();!v.done;v=p.next()){var y=v.value;y.type===Ht?f[y.activity.id||y.activity.type]=y:y.type===Bt&&(f[y.activity.id||y.activity.type]=!1)}}catch(t){r={error:t}}finally{try{v&&!v.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}var g,m,_=st(pe(this,e,l,n,d,this.machine.config.preserveActionOrder),2),w=_[0],S=_[1],x=st(Et(w,(function(t){return t.type===Ft||t.type===Jt&&t.to===Rt.Internal})),2),b=x[0],E=x[1],$=w.filter((function(t){var e;return t.type===Ht&&(null===(e=t.activity)||void 0===e?void 0:e.type)===Zt})),A=$.reduce((function(t,e){return t[e.activity.id]=Te(e.activity,s.machine,S,n),t}),e?it({},e.children):{}),C=u?t.configuration:e?e.configuration:[],N=be(C,this),T=new Ae({value:u||e.value,context:S,_event:n,_sessionid:e?e._sessionid:null,historyValue:u?h?(g=h,m=u,{current:m,states:$t(g,m)}):void 0:e?e.historyValue:void 0,history:!u||t.source?e:void 0,actions:u?E:[],activities:u?f:e?e.activities:{},events:[],configuration:C,transitions:t.transitions,children:A,done:N,tags:null==e?void 0:e.tags,machine:this}),O=l!==S;T.changed=n.name===te||O;var P=T.history;P&&delete P.history;var k=!N&&(this._transient||a.some((function(t){return t._transient})));if(!(c||k&&""!==n.name))return T;var R=T;if(!N)for(k&&(R=this.resolveRaisedTransition(R,{type:Gt},n));b.length;){var U=b.shift();R=this.resolveRaisedTransition(R,U._event,n)}var M=R.changed||(P?!!R.actions.length||O||typeof P.value!=typeof R.value||!$e(R.value,P.value):void 0);return R.changed=M,R.history=P,R.tags=Ee(R.configuration),R},t.prototype.getStateNode=function(t){if(Re(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},t.prototype.getStateNodeById=function(t){var e=Re(t)?t.slice("#".length):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&Re(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var e=dt(t,this.delimiter).slice(),n=this;e.length;){var i=e.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||ke;switch(this.type){case"parallel":return vt(this.initialStateValue,(function(e,i){return e?n.getStateNode(i).resolve(t[i]||e):ke}));case"compound":if(Ot(t)){var i=this.getStateNode(t);return"parallel"===i.type||"compound"===i.type?((e={})[t]=i.initialStateValue,e):t}return ut(t).length?vt(t,(function(t,e){return t?n.getStateNode(e).resolve(t):ke})):this.initialStateValue||{};default:return t||ke}},t.prototype.getResolvedPath=function(t){if(Re(t)){var e=this.machine.idMap[t.slice("#".length)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return dt(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t,e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)e=yt(this.states,(function(t){return t.initialStateValue||ke}),(function(t){return!("history"===t.type)}));else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=ve(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(t,e){var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,void 0,e)},Object.defineProperty(t.prototype,"initialState",{get:function(){this._init();var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=Ot(e.target)&&Re(e.target)?pt(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(t,e,n){return void 0===n&&(n=!0),n?"history"===t.type?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;return ve(this)?[this]:"compound"!==this.type||this.initial?_t(mt(this.initialStateValue).map((function(e){return t.getFromRelativePath(e)}))):(Ct(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this])},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=st(t),n=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var r=this.getStateNode(n);if("history"===r.type)return r.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(t){if(ut(this.states).length)return{current:t||this.initialStateValue,states:yt(this.states,(function(e,n){if(!t)return e.historyValue();var i=Ot(t)?void 0:t[n];return e.historyValue(i||e.initialStateValue)}),(function(t){return!t.history}))}},t.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var n=this.parent;if(!t){var i=this.target;return i?_t(mt(i).map((function(t){return n.getFromRelativePath(t)}))):n.initialStateNodes}var r,o,s=(r=n.path,o="states",function(t){var e,n,i=t;try{for(var s=ot(r),a=s.next();!a.done;a=s.next()){var c=a.value;i=i[o][c]}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return i})(t).current;return Ot(s)?[n.getStateNode(s)]:_t(mt(s).map((function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]})))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,e=_t(ut(this.states).map((function(e){return t.states[e].stateIds})));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var t,e,n,i;if(this.__cache.events)return this.__cache.events;var r=this.states,o=new Set(this.ownEvents);if(r)try{for(var s=ot(ut(r)),a=s.next();!a.done;a=s.next()){var c=r[a.value];if(c.states)try{for(var u=(n=void 0,ot(c.events)),h=u.next();!h.done;h=u.next()){var l=h.value;o.add("".concat(l))}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter((function(t){return!(!t.target&&!t.actions.length&&t.internal)})).map((function(t){return t.eventType})));return Array.from(t)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(t){var e=this;if(void 0!==t)return t.map((function(t){if(!Ot(t))return t;var n=t[0]===e.delimiter;if(n&&!e.parent)return e.getStateNodeByPath(t.slice(1));var i=n?e.key+t:t;if(!e.parent)return e.getStateNodeByPath(i);try{return e.parent.getStateNodeByPath(i)}catch(t){throw new Error("Invalid transition definition for state node '".concat(e.id,"':\n").concat(t.message))}}))},t.prototype.formatTransition=function(t){var e=this,n=function(t){if(void 0!==t&&""!==t)return St(t)}(t.target),i="internal"in t?t.internal:!n||n.some((function(t){return Ot(t)&&t[0]===e.delimiter})),r=this.machine.options.guards,o=this.resolveTarget(n),s=it(it({},t),{actions:se(St(t.actions)),cond:Pt(t.cond,r),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return it(it({},s),{target:s.target?s.target.map((function(t){return"#".concat(t.id)})):void 0,source:"#".concat(e.id)})}});return s},t.prototype.formatTransitions=function(){var t,e,n,i=this;if(this.config.on)if(Array.isArray(this.config.on))n=this.config.on;else{var r=this.config.on,o="*",s=r[o],a=void 0===s?[]:s,c=rt(r,["*"]);n=_t(ut(c).map((function(t){""===t&&Ct(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(i.id,'".'));var e=Lt(t,c[t]);return function(t,e,n){var i=n.slice(0,-1).some((function(t){return!("cond"in t)&&!("in"in t)&&(Ot(t.target)||Mt(t.target))})),r=""===e?"the transient event":"event '".concat(e,"'");Ct(!i,"One or more transitions for ".concat(r," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")}(i,t,e),e})).concat(Lt("*",a)))}else n=[];var u=this.config.always?Lt("",this.config.always):[],h=this.config.onDone?Lt(String(le(this.id)),this.config.onDone):[];Ct(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var l=_t(this.invoke.map((function(t){var e=[];return t.onDone&&e.push.apply(e,at([],st(Lt(String(de(t.id)),t.onDone)),!1)),t.onError&&e.push.apply(e,at([],st(Lt(String(fe(t.id)),t.onError)),!1)),e}))),d=this.after,f=_t(at(at(at(at([],st(h),!1),st(l),!1),st(n),!1),st(u),!1).map((function(t){return St(t).map((function(t){return i.formatTransition(t)}))})));try{for(var p=ot(d),v=p.next();!v.done;v=p.next()){var y=v.value;f.push(y)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}return f},t}();function Me(t,e){return new Ue(t,e)}var je={deferEvents:!1},De=function(){function t(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=it(it({},je),t)}return t.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()},t.prototype.schedule=function(t){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},t.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},t}(),Le=new Map,Ie=0,ze=function(){return"x:".concat(Ie++)},Ve=function(t,e){return Le.set(t,e),t},He=function(t){return Le.get(t)},Be=function(t){Le.delete(t)};function Fe(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0}function Je(t){if(Fe()){var e=function(){var t=Fe();if(t&&"__xstate__"in t)return t.__xstate__}();e&&e.register(t)}}function qe(t,e){void 0===e&&(e={});var n,i=t.initialState,r=new Set,o=[],s=!1,a=(n={id:e.id,send:function(e){o.push(e),function(){if(!s){for(s=!0;o.length>0;){var e=o.shift();i=t.transition(i,e,c),r.forEach((function(t){return t.next(i)}))}s=!1}}()},getSnapshot:function(){return i},subscribe:function(t,e,n){var o=Vt(t,e,n);return r.add(o),o.next(i),{unsubscribe:function(){r.delete(o)}}}},it({subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},n)),c={parent:e.parent,self:a,id:e.id||"anonymous",observers:r};return i=t.start?t.start(c):i,a}var Ge,We={sync:!1,autoForward:!1};!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(Ge||(Ge={}));var Xe=function(){function t(e,n){var i=this;void 0===n&&(n=t.defaultOptions),this.machine=e,this.scheduler=new De,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=Ge.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(t,e){if(Nt(t))return i.batch(t),i.state;var n=Dt(jt(t,e));if(i.status===Ge.Stopped)return Ct(!1,'Event "'.concat(n.name,'" was sent to stopped service "').concat(i.machine.id,'". This service has already reached its final state, and will not transition.\nEvent: ').concat(JSON.stringify(n.data))),i.state;if(i.status!==Ge.Running&&!i.options.deferEvents)throw new Error('Event "'.concat(n.name,'" was sent to uninitialized service "').concat(i.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(n.data)));return i.scheduler.schedule((function(){i.forward(n);var t=i.nextState(n);i.update(t,n)})),i._state},this.sendTo=function(t,e){var n,r=i.parent&&(e===Rt.Parent||i.parent.id===e),o=r?i.parent:Ot(e)?i.children.get(e)||He(e):(n=e)&&"function"==typeof n.send?e:void 0;if(o)"machine"in o?o.send(it(it({},t),{name:t.name===Yt?"".concat(fe(i.id)):t.name,origin:i.sessionId})):o.send(t.data);else{if(!r)throw new Error("Unable to send event to child '".concat(e,"' from service '").concat(i.id,"'."));Ct(!1,"Service '".concat(i.id,"' has no parent: unable to send event ").concat(t.type))}};var r=it(it({},t.defaultOptions),n),o=r.clock,s=r.logger,a=r.parent,c=r.id,u=void 0!==c?c:e.id;this.id=u,this.logger=s,this.clock=o,this.parent=a,this.options=r,this.scheduler=new De({deferEvents:this.options.deferEvents}),this.sessionId=ze()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:Ce(this,(function(){return t._initialState=t.machine.initialState,t._initialState}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return Ct(this.status!==Ge.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(t,e){var n,i;try{for(var r=ot(t.actions),o=r.next();!o.done;o=r.next()){var s=o.value;this.exec(s,t,e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}},t.prototype.update=function(t,e){var n,i,r,o,s,a,c,u,h=this;if(t._sessionid=this.sessionId,this._state=t,this.options.execute&&this.execute(this.state),this.children.forEach((function(t){h.state.children[t.id]=t})),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var l=ot(this.eventListeners),d=l.next();!d.done;d=l.next()){(0,d.value)(t.event)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}try{for(var f=ot(this.listeners),p=f.next();!p.done;p=f.next()){(0,p.value)(t,t.event)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}try{for(var v=ot(this.contextListeners),y=v.next();!y.done;y=v.next()){(0,y.value)(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(t){s={error:t}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(s)throw s.error}}var g=be(t.configuration||[],this.machine);if(this.state.configuration&&g){var m=t.configuration.find((function(t){return"final"===t.type&&t.parent===h.machine})),_=m&&m.doneData?xt(m.doneData,t.context,e):void 0;try{for(var w=ot(this.doneListeners),S=w.next();!S.done;S=w.next()){(0,S.value)(de(this.id,_))}}catch(t){c={error:t}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(c)throw c.error}}this.stop()}},t.prototype.onTransition=function(t){return this.listeners.add(t),this.status===Ge.Running&&t(this.state,this.state.event),this},t.prototype.subscribe=function(t,e,n){var i,r=this;if(!t)return{unsubscribe:function(){}};var o=n;return"function"==typeof t?i=t:(i=t.next.bind(t),o=t.complete.bind(t)),this.listeners.add(i),this.status===Ge.Running&&i(this.state),o&&this.onDone(o),{unsubscribe:function(){i&&r.listeners.delete(i),o&&r.doneListeners.delete(o)}}},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){var e=this;if(this.status===Ge.Running)return this;Ve(this.sessionId,this),this.initialized=!0,this.status=Ge.Running;var n=void 0===t?this.initialState:Ce(this,(function(){return!Ot(n=t)&&"value"in n&&"history"in n?e.machine.resolveState(t):e.machine.resolveState(Ae.from(t,e.machine.context));var n}));return this.options.devTools&&this.attachDev(),this.scheduler.initialize((function(){e.update(n,ie)})),this},t.prototype.stop=function(){var t,e,n,i,r,o,s,a,c,u,h=this;try{for(var l=ot(this.listeners),d=l.next();!d.done;d=l.next()){var f=d.value;this.listeners.delete(f)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}try{for(var p=ot(this.stopListeners),v=p.next();!v.done;v=p.next()){(f=v.value)(),this.stopListeners.delete(f)}}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}try{for(var y=ot(this.contextListeners),g=y.next();!g.done;g=y.next()){f=g.value;this.contextListeners.delete(f)}}catch(t){r={error:t}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}try{for(var m=ot(this.doneListeners),_=m.next();!_.done;_=m.next()){f=_.value;this.doneListeners.delete(f)}}catch(t){s={error:t}}finally{try{_&&!_.done&&(a=m.return)&&a.call(m)}finally{if(s)throw s.error}}if(!this.initialized)return this;this.state.configuration.forEach((function(t){var e,n;try{for(var i=ot(t.definition.exit),r=i.next();!r.done;r=i.next()){var o=r.value;h.exec(o,h.state)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}})),this.children.forEach((function(t){Tt(t.stop)&&t.stop()}));try{for(var w=ot(ut(this.delayedEventsMap)),S=w.next();!S.done;S=w.next()){var x=S.value;this.clock.clearTimeout(this.delayedEventsMap[x])}}catch(t){c={error:t}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(c)throw c.error}}return this.scheduler.clear(),this.initialized=!1,this.status=Ge.Stopped,Be(this.sessionId),this},t.prototype.batch=function(t){var e=this;if(this.status===Ge.NotStarted&&this.options.deferEvents)Ct(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'" and are deferred. Make sure .start() is called for this service.\nEvent: ').concat(JSON.stringify(event)));else if(this.status!==Ge.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));this.scheduler.schedule((function(){var n,i,r=e.state,o=!1,s=[],a=function(t){var n=Dt(t);e.forward(n),r=Ce(e,(function(){return e.machine.transition(r,n)})),s.push.apply(s,at([],st(r.actions.map((function(t){return n=r,i=(e=t).exec,it(it({},e),{exec:void 0!==i?function(){return i(n.context,n.event,{action:e,state:n,_event:n._event})}:void 0});var e,n,i}))),!1)),o=o||!!r.changed};try{for(var c=ot(t),u=c.next();!u.done;u=c.next()){a(u.value)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}r.changed=o,r.actions=s,e.update(r,Dt(t[t.length-1]))}))},t.prototype.sender=function(t){return this.send.bind(this,t)},t.prototype.nextState=function(t){var e=this,n=Dt(t);if(0===n.name.indexOf(Qt)&&!this.state.nextEvents.some((function(t){return 0===t.indexOf(Qt)})))throw n.data.data;return Ce(this,(function(){return e.machine.transition(e.state,n)}))},t.prototype.forward=function(t){var e,n;try{for(var i=ot(this.forwardTo),r=i.next();!r.done;r=i.next()){var o=r.value,s=this.children.get(o);if(!s)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));s.send(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.defer=function(t){var e=this;this.delayedEventsMap[t.id]=this.clock.setTimeout((function(){t.to?e.sendTo(t._event,t.to):e.send(t._event)}),t.delay)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,e,n){void 0===n&&(n=this.machine.options.actions);var i=e.context,r=e._event,o=t.exec||re(t.type,n),s=Tt(o)?o:o?o.exec:t.exec;if(s)try{return s(i,r.data,{action:t,state:this.state,_event:r})}catch(t){throw this.parent&&this.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case Jt:var a=t;if("number"==typeof a.delay)return void this.defer(a);a.to?this.sendTo(a._event,a.to):this.send(a._event);break;case qt:this.cancel(t.sendId);break;case Ht:if(this.status!==Ge.Running)return;var c=t.activity;if(!this.state.activities[c.id||c.type])break;if(c.type===kt.Invoke){var u=zt(c.src),h=this.machine.options.services?this.machine.options.services[u.type]:void 0,l=c.id,d=c.data;Ct(!("forward"in c),"`forward` property is deprecated (found in invocation of '".concat(c.src,"' in in machine '").concat(this.machine.id,"'). ")+"Please use `autoForward` instead.");var f="autoForward"in c?c.autoForward:!!c.forward;if(!h)return void Ct(!1,"No service found for invocation '".concat(c.src,"' in machine '").concat(this.machine.id,"'."));var p=d?xt(d,i,r):void 0;if("string"==typeof h)return;var v=Tt(h)?h(i,r.data,{data:p,src:u,meta:c.meta}):h;if(!v)return;var y=void 0;Mt(v)&&(v=p?v.withContext(p):v,y={autoForward:f}),this.spawn(v,l,y)}else this.spawnActivity(c);break;case Bt:this.stopChild(t.activity.id);break;case Xt:var g=t.label,m=t.value;g?this.logger(g,m):this.logger(m);break;default:Ct(!1,"No implementation found for action type '".concat(t.type,"'"))}},t.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),null===(e=this.state)||void 0===e||delete e.children[t]},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),Tt(e.stop)&&e.stop())},t.prototype.spawn=function(t,e,n){if(bt(t))return this.spawnPromise(Promise.resolve(t),e);if(Tt(t))return this.spawnCallback(t,e);if(function(t){try{return"function"==typeof t.send}catch(t){return!1}}(r=t)&&"id"in r)return this.spawnActor(t,e);if(function(t){try{return"subscribe"in t&&Tt(t.subscribe)}catch(t){return!1}}(t))return this.spawnObservable(t,e);if(Mt(t))return this.spawnMachine(t,it(it({},n),{id:e}));if(null!==(i=t)&&"object"==typeof i&&"transition"in i&&"function"==typeof i.transition)return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'));var i,r},t.prototype.spawnMachine=function(e,n){var i=this;void 0===n&&(n={});var r=new t(e,it(it({},this.options),{parent:this,id:n.id||e.id})),o=it(it({},We),n);o.sync&&r.onTransition((function(t){i.send(te,{state:t,id:r.id})}));var s=r;return this.children.set(r.id,s),o.autoForward&&this.forwardTo.add(r.id),r.onDone((function(t){i.removeChild(r.id),i.send(Dt(t,{origin:r.id}))})).start(),s},t.prototype.spawnBehavior=function(t,e){var n=qe(t,{id:e,parent:this});return this.children.set(e,n),n},t.prototype.spawnPromise=function(t,e){var n,i=this,r=!1;t.then((function(t){r||(n=t,i.removeChild(e),i.send(Dt(de(e,t),{origin:e})))}),(function(t){if(!r){i.removeChild(e);var n=fe(e,t);try{i.send(Dt(n,{origin:e}))}catch(r){!function(t,e,n){var i=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(n,"', error was '").concat(t,"'.").concat(i));else{var r=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(n,"'. ")+"Original error: '".concat(t,"'. ").concat(i," Current error is '").concat(e,"'.").concat(r))}}(t,r,e),i.devTools&&i.devTools.send(n,i.state),i.machine.strict&&i.stop()}}}));var o={id:e,send:function(){},subscribe:function(e,n,i){var r=Vt(e,n,i),o=!1;return t.then((function(t){o||(r.next(t),o||r.complete())}),(function(t){o||r.error(t)})),{unsubscribe:function(){return o=!0}}},stop:function(){r=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return n}};return this.children.set(e,o),o},t.prototype.spawnCallback=function(t,e){var n,i,r=this,o=!1,s=new Set,a=new Set;try{i=t((function(t){n=t,a.forEach((function(e){return e(t)})),o||r.send(Dt(t,{origin:e}))}),(function(t){s.add(t)}))}catch(t){this.send(fe(e,t))}if(bt(i))return this.spawnPromise(i,e);var c={id:e,send:function(t){return s.forEach((function(e){return e(t)}))},subscribe:function(t){return a.add(t),{unsubscribe:function(){a.delete(t)}}},stop:function(){o=!0,Tt(i)&&i()},toJSON:function(){return{id:e}},getSnapshot:function(){return n}};return this.children.set(e,c),c},t.prototype.spawnObservable=function(t,e){var n,i=this,r=t.subscribe((function(t){n=t,i.send(Dt(t,{origin:e}))}),(function(t){i.removeChild(e),i.send(Dt(fe(e,t),{origin:e}))}),(function(){i.removeChild(e),i.send(Dt(de(e),{origin:e}))})),o={id:e,send:function(){},subscribe:function(e,n,i){return t.subscribe(e,n,i)},stop:function(){return r.unsubscribe()},getSnapshot:function(){return n},toJSON:function(){return{id:e}}};return this.children.set(e,o),o},t.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},t.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var n=e(this.state.context,t);this.spawnEffect(t.id,n)}else Ct(!1,"No implementation found for activity '".concat(t.type,"'"))},t.prototype.spawnEffect=function(t,e){this.children.set(t,{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})},t.prototype.attachDev=function(){var t=Fe();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(it(it({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},e),{features:it({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}Je(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[Ut]=function(){return this},t.prototype.getSnapshot=function(){return this.status===Ge.NotStarted?this.initialState:this._state},t.defaultOptions=function(t){return{execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:t.console.log.bind(console),devTools:!1}}("undefined"!=typeof self?self:global),t.interpret=Ke,t}();function Ke(t,e){return new Xe(t,e)}const Ze=Me({id:"gameplay-machine",initial:"dealing",states:{dealing:{after:{500:{target:"gameover"}}},gameover:{type:"final"}}});const Qe=he({catUrls:(t,e)=>{const n=e.data;return[...t.catUrls,n]}});const Ye=Me({id:"memory-cat",initial:"welcome",context:{catUrls:[],gamesize:6},states:{welcome:{on:{CONFIG:{actions:"applyConfig"},START:[{target:"fetchCats",cond:"validConfig"},{target:"error"}]}},fetchCats:{always:{target:"gameplay",cond:"enoughCats"},invoke:{id:"fetchCats",src:()=>new Promise((t=>setTimeout(t,1e3))).then((()=>`Cat=${Math.floor(1e3*Math.random())}`)),onDone:{target:"fetchCats",actions:"storeCatUrl"},onError:{target:"error"}}},gameplay:{invoke:{id:"gameplay-machine",src:Ze,onDone:"gameover"}},gameover:{},error:{after:{2e3:{target:"welcome"}}}}},{actions:{applyConfig:he({gamesize:(t,e)=>e.gamesize}),storeCatUrl:Qe},guards:{enoughCats:function(t){return t.catUrls.length>=t.gamesize},validConfig:function(t){return t.gamesize>2&&t.gamesize<=12}}});let tn=class extends Z{render(){return k` <main> <form @submit="${this._startGame}" @change="${this._applyConfig}" id="options-form"> <label for="gamesize">Game Size:</label> <select name="gamesize" id="gamesize" form="options-form"> <option value="3">Small</option> <option value="6" selected="selected">Medium</option> <option value="8">Large</option> <option value="12">Super</option> </select> <br> <input type="submit" value="Start Game"> </form> </main> `}_applyConfig(){const t=this.shadowRoot.getElementById("options-form").elements,e=parseInt(t.gamesize.value,10),n=new CustomEvent("memory-cat-event",{bubbles:!0,composed:!0,detail:{type:"CONFIG",gamesize:e}});this.dispatchEvent(n)}_startGame(t){t.preventDefault();const e=new CustomEvent("memory-cat-event",{bubbles:!0,composed:!0,detail:{type:"START"}});this.dispatchEvent(e)}};tn.styles=o``,tn=t([Y("mc-welcome")],tn);let en=class extends Z{constructor(){super(...arguments),this.numFetched=0,this.catsRequired=0}render(){return k` <main> <p>Fetched ${this.numFetched} / ${this.catsRequired}</p> </main> `}};en.styles=o``,t([et({type:String})],en.prototype,"numFetched",void 0),t([et({type:String})],en.prototype,"catsRequired",void 0),en=t([Y("mc-fetch")],en);const nn=Ke(Ye);function rn(t){nn.send(t.detail)}class on extends Z{constructor(){super(),this.stateName="",this.context={catUrls:[],gamesize:6},nn.onTransition((t=>{const e=JSON.stringify(t.value);this.stateName=e.replace(/"/g,""),this.context=t.context})),nn.start(),this.addEventListener("memory-cat-event",rn)}render(){return k` <main> <h1>Memory Cats!</h1> ${this.renderApp()} <p>State = ${this.stateName}</p> <p>Context = ${JSON.stringify(this.context)}</p> </main> `}renderApp(){switch(this.stateName){case"welcome":return k`<mc-welcome></mc-welcome>`;case"fetchCats":return k`<mc-fetch catsRequired="${this.context.gamesize}" numFetched="${this.context.catUrls.length}"></mc-fetch>`;default:return k`Error!`}}}on.styles=o`:host{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;font-size:calc(10px + 2vmin);color:#1a2b42;max-width:960px;margin:0 auto;text-align:center;background-color:var(--memory-cat-app-background-color)}main{flex-grow:1}.app-footer{font-size:calc(12px + .5vmin);align-items:center}.app-footer a{margin-left:5px}`,t([et({type:String})],on.prototype,"stateName",void 0),t([et({type:Object})],on.prototype,"context",void 0),customElements.define("memory-cat-app",on);
